{% extends "base.html" %}

{% block title %}–ó–∞–∫–∞–∑—ã ‚Äî Photo28 Admin{% endblock %}

{% block extra_head %}
<style>
    .search-filters {
        display: flex;
        gap: 1rem;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
        align-items: flex-end;
    }
    
    .filter-group {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }
    
    .filter-group label {
        font-size: 0.8rem;
        color: var(--text-muted);
    }
    
    .filter-group input,
    .filter-group select {
        padding: 0.5rem 0.75rem;
        border: 1px solid var(--border);
        border-radius: 6px;
        background: var(--bg-secondary);
        color: var(--text);
        font-size: 0.9rem;
    }
    
    .filter-group input[type="text"] {
        min-width: 200px;
    }
    
    .filter-group input[type="date"] {
        min-width: 140px;
    }
    
    .pagination {
        display: flex;
        justify-content: center;
        gap: 0.5rem;
        margin-top: 1.5rem;
    }
    
    .pagination a, .pagination span {
        padding: 0.5rem 1rem;
        border-radius: 6px;
        text-decoration: none;
        font-size: 0.9rem;
    }
    
    .pagination a {
        background: var(--bg-secondary);
        color: var(--text);
        border: 1px solid var(--border);
    }
    
    .pagination a:hover {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
    }
    
    .pagination .current {
        background: var(--primary);
        color: white;
    }
    
    .pagination .disabled {
        opacity: 0.5;
        pointer-events: none;
    }
    
    .results-count {
        font-size: 0.9rem;
        color: var(--text-muted);
        margin-bottom: 1rem;
    }
    
    .clear-filters {
        font-size: 0.85rem;
        color: var(--text-muted);
        margin-left: auto;
    }
</style>
{% endblock %}

{% block content %}
<h1 style="margin-bottom: 1.5rem;">üìã –ó–∞–∫–∞–∑—ã</h1>

<!-- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã -->
<form method="get" action="/orders" class="search-filters">
    <div class="filter-group">
        <label>–ü–æ–∏—Å–∫</label>
        <input type="text" name="search" placeholder="–ù–æ–º–µ—Ä, @username..." value="{{ search }}">
    </div>
    
    <div class="filter-group">
        <label>–°—Ç–∞—Ç—É—Å</label>
        <select name="status">
            <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
            <option value="pending_payment" {% if current_status == 'pending_payment' %}selected{% endif %}>‚è≥ –û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã</option>
            <option value="paid" {% if current_status == 'paid' %}selected{% endif %}>üí≥ –û–ø–ª–∞—á–µ–Ω</option>
            <option value="confirmed" {% if current_status == 'confirmed' %}selected{% endif %}>‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω</option>
            <option value="printing" {% if current_status == 'printing' %}selected{% endif %}>üñ® –í –ø–µ—á–∞—Ç–∏</option>
            <option value="ready" {% if current_status == 'ready' %}selected{% endif %}>üì¶ –ì–æ—Ç–æ–≤</option>
            <option value="shipped" {% if current_status == 'shipped' %}selected{% endif %}>üöö –û—Ç–ø—Ä–∞–≤–ª–µ–Ω</option>
            <option value="delivered" {% if current_status == 'delivered' %}selected{% endif %}>‚úÖ –î–æ—Å—Ç–∞–≤–ª–µ–Ω</option>
        </select>
    </div>
    
    <div class="filter-group">
        <label>–° –¥–∞—Ç—ã</label>
        <input type="date" name="date_from" value="{{ date_from }}">
    </div>
    
    <div class="filter-group">
        <label>–ü–æ –¥–∞—Ç—É</label>
        <input type="date" name="date_to" value="{{ date_to }}">
    </div>
    
    <button type="submit" class="btn btn-primary">üîç –ù–∞–π—Ç–∏</button>
    
    {% if search or current_status or date_from or date_to %}
    <a href="/orders" class="clear-filters">‚úï –°–±—Ä–æ—Å–∏—Ç—å</a>
    {% endif %}
</form>

<!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
<div class="results-count">
    –ù–∞–π–¥–µ–Ω–æ: <strong>{{ total_count }}</strong> –∑–∞–∫–∞–∑–æ–≤
    {% if total_pages > 1 %}
    ‚Ä¢ –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page }} –∏–∑ {{ total_pages }}
    {% endif %}
</div>

<div class="card">
    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>–ù–æ–º–µ—Ä</th>
                    <th>–ö–ª–∏–µ–Ω—Ç</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–î–æ—Å—Ç–∞–≤–∫–∞</th>
                    <th>–§–æ—Ç–æ</th>
                    <th>–°—É–º–º–∞</th>
                    <th>–î–∞—Ç–∞</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for order in orders %}
                <tr>
                    <td><strong>{{ order.order_number }}</strong></td>
                    <td>
                        {{ order.user.display_name if order.user else '‚Äî' }}
                        {% if order.user and order.user.username %}
                        <br><small style="color: var(--text-muted);">@{{ order.user.username }}</small>
                        {% endif %}
                    </td>
                    <td>
                        <span class="badge badge-{{ order.status.value }}">{{ order.status.display_name }}</span>
                    </td>
                    <td>{{ order.delivery_type.display_name if order.delivery_type else '‚Äî' }}</td>
                    <td>{{ order.photos_count }} —à—Ç.</td>
                    <td>{{ order.total_cost }}‚ÇΩ</td>
                    <td>{{ order.created_at.strftime('%d.%m.%Y %H:%M') }}</td>
                    <td>
                        <a href="/orders/{{ order.id }}" class="btn btn-secondary btn-sm">–û—Ç–∫—Ä—ã—Ç—å</a>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="8" style="text-align: center; color: var(--text-muted); padding: 2rem;">
                        –ó–∞–∫–∞–∑–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
{% if total_pages > 1 %}
<div class="pagination">
    {% set params = [] %}
    {% if search %}{% set _ = params.append('search=' + search) %}{% endif %}
    {% if current_status %}{% set _ = params.append('status=' + current_status) %}{% endif %}
    {% if date_from %}{% set _ = params.append('date_from=' + date_from) %}{% endif %}
    {% if date_to %}{% set _ = params.append('date_to=' + date_to) %}{% endif %}
    {% set base_url = '/orders?' + params|join('&') + ('&' if params else '') %}
    
    {% if page > 1 %}
    <a href="{{ base_url }}page={{ page - 1 }}">‚Üê –ù–∞–∑–∞–¥</a>
    {% else %}
    <span class="disabled">‚Üê –ù–∞–∑–∞–¥</span>
    {% endif %}
    
    {% for p in range(1, total_pages + 1) %}
        {% if p == page %}
        <span class="current">{{ p }}</span>
        {% elif p <= 3 or p > total_pages - 3 or (p >= page - 1 and p <= page + 1) %}
        <a href="{{ base_url }}page={{ p }}">{{ p }}</a>
        {% elif p == 4 or p == total_pages - 3 %}
        <span>...</span>
        {% endif %}
    {% endfor %}
    
    {% if page < total_pages %}
    <a href="{{ base_url }}page={{ page + 1 }}">–í–ø–µ—Ä—ë–¥ ‚Üí</a>
    {% else %}
    <span class="disabled">–í–ø–µ—Ä—ë–¥ ‚Üí</span>
    {% endif %}
</div>
{% endif %}
{% endblock %}
