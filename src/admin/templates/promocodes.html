{% extends "base.html" %}

{% block title %}–ü—Ä–æ–º–æ–∫–æ–¥—ã ‚Äî Photo28 Admin{% endblock %}

{% block content %}
<h1 style="margin-bottom: 2rem;">üéü –ü—Ä–æ–º–æ–∫–æ–¥—ã</h1>

<div class="card">
    <div class="card-header">
        <h2 class="card-title">–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥</h2>
    </div>
    
    <form method="post" action="/promocodes">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
            <div class="form-group" style="margin-bottom: 0;">
                <label class="form-label" for="code">–ö–æ–¥*</label>
                <input type="text" id="code" name="code" class="form-input" required placeholder="WELCOME10" style="text-transform: uppercase;">
            </div>
            
            <div class="form-group" style="margin-bottom: 0;">
                <label class="form-label" for="discount_percent">–°–∫–∏–¥–∫–∞ %</label>
                <input type="number" id="discount_percent" name="discount_percent" class="form-input" placeholder="10" min="1" max="100">
            </div>
            
            <div class="form-group" style="margin-bottom: 0;">
                <label class="form-label" for="discount_amount">–ò–ª–∏ —Ñ–∏–∫—Å. —Å—É–º–º–∞ ‚ÇΩ</label>
                <input type="number" id="discount_amount" name="discount_amount" class="form-input" placeholder="100" min="1">
            </div>
            
            <div class="form-group" style="margin-bottom: 0;">
                <label class="form-label" for="max_uses">–ú–∞–∫—Å. –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π</label>
                <input type="number" id="max_uses" name="max_uses" class="form-input" placeholder="‚àû" min="1">
            </div>
            
            <div class="form-group" style="margin-bottom: 0;">
                <label class="form-label" for="description">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                <input type="text" id="description" name="description" class="form-input" placeholder="–î–ª—è –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤">
            </div>
        </div>
        
        <div style="margin-top: 1rem; padding: 1rem; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px;">
            <div style="color: var(--text-muted); font-size: 0.8125rem; margin-bottom: 0.75rem; font-weight: 500;">–£—Å–ª–æ–≤–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è</div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                <div class="form-group" style="margin-bottom: 0;">
                    <label class="form-label" for="min_order_amount">–ú–∏–Ω. —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞ ‚ÇΩ</label>
                    <input type="number" id="min_order_amount" name="min_order_amount" class="form-input" placeholder="0" min="0" value="0">
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                    <label class="form-label" for="min_photos">–ú–∏–Ω. –∫–æ–ª-–≤–æ —Ñ–æ—Ç–æ</label>
                    <input type="number" id="min_photos" name="min_photos" class="form-input" placeholder="0" min="0" value="0">
                    <span style="font-size: 0.6875rem; color: var(--text-muted);">0 = –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è</span>
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                    <label class="form-label" style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" id="require_subscription" name="require_subscription" value="1" style="width: 18px; height: 18px; accent-color: var(--primary);">
                        –¢—Ä–µ–±–æ–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ –∫–∞–Ω–∞–ª
                    </label>
                    <span style="font-size: 0.6875rem; color: var(--text-muted);">–ö–∞–Ω–∞–ª –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ <a href="/settings" style="color: var(--primary);">–ù–∞—Å—Ç—Ä–æ–π–∫–∞—Ö</a></span>
                </div>
            </div>
        </div>
        
        <button type="submit" class="btn btn-primary" style="margin-top: 1rem;">–°–æ–∑–¥–∞—Ç—å</button>
    </form>
</div>

<div class="card">
    <div class="card-header">
        <h2 class="card-title">–í—Å–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã</h2>
    </div>
    
    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>–ö–æ–¥</th>
                    <th>–°–∫–∏–¥–∫–∞</th>
                    <th>–£—Å–ª–æ–≤–∏—è</th>
                    <th>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π</th>
                    <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–°–æ–∑–¥–∞–Ω</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for promo in promocodes %}
                <tr>
                    <td><strong>{{ promo.code }}</strong></td>
                    <td>
                        {% if promo.discount_percent %}
                        {{ promo.discount_percent }}%
                        {% elif promo.discount_amount %}
                        {{ promo.discount_amount }}‚ÇΩ
                        {% endif %}
                    </td>
                    <td style="font-size: 0.8125rem; color: var(--text-muted);">
                        {% set conditions = [] %}
                        {% if promo.min_order_amount > 0 %}
                            {% set _ = conditions.append('–æ—Ç ' ~ promo.min_order_amount ~ '‚ÇΩ') %}
                        {% endif %}
                        {% if promo.min_photos > 0 %}
                            {% set _ = conditions.append('–æ—Ç ' ~ promo.min_photos ~ ' —Ñ–æ—Ç–æ') %}
                        {% endif %}
                        {% if promo.require_subscription %}
                            {% set _ = conditions.append('üì¢ –ø–æ–¥–ø–∏—Å–∫–∞') %}
                        {% endif %}
                        {{ conditions | join(', ') if conditions else '‚Äî' }}
                    </td>
                    <td>
                        {{ promo.current_uses }}{% if promo.max_uses %} / {{ promo.max_uses }}{% endif %}
                    </td>
                    <td>{{ promo.description or '‚Äî' }}</td>
                    <td>
                        {% if promo.is_active %}
                        <span class="badge badge-paid">–ê–∫—Ç–∏–≤–µ–Ω</span>
                        {% else %}
                        <span class="badge badge-cancelled">–ù–µ–∞–∫—Ç–∏–≤–µ–Ω</span>
                        {% endif %}
                    </td>
                    <td>{{ promo.created_at.strftime('%d.%m.%Y') }}</td>
                    <td style="white-space: nowrap;">
                        <form method="post" action="/promocodes/{{ promo.id }}/toggle" style="display: inline;">
                            <button type="submit" class="btn btn-sm" title="{% if promo.is_active %}–û—Ç–∫–ª—é—á–∏—Ç—å{% else %}–í–∫–ª—é—á–∏—Ç—å{% endif %}">
                                {% if promo.is_active %}‚è∏{% else %}‚ñ∂{% endif %}
                            </button>
                        </form>
                        <form method="post" action="/promocodes/{{ promo.id }}/delete" style="display: inline;" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥ {{ promo.code }}?')">
                            <button type="submit" class="btn btn-sm btn-danger" title="–£–¥–∞–ª–∏—Ç—å">üóë</button>
                        </form>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="8" style="text-align: center; color: var(--text-muted);">
                        –ü—Ä–æ–º–æ–∫–æ–¥–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
